# Rubrik CDM As Built Report

# Getting Started
Below are the instructions on how to install, configure and generate a Rubrik CDM As Built report.

## Pre-requisites
The following PowerShell modules are required for generating a Rubrik As Built report.

Each of these modules can be easily downloaded and installed via the PowerShell Gallery 

- [Rubrik CDM Powershell SDK](https://www.powershellgallery.com/packages/Rubrik/) *Note:* The Rubrik As Built Report Module currently relies on the `devel` branch of the Rubrik PowerShell SDK. Follow the instructions below to ensure the `devel` branch is the active installation.
- [AsBuiltReport Module](https://www.powershellgallery.com/packages/AsBuiltReport/)

### Module Installation

### Installing the Rubrik CDM PowerShell SDK devel branch

The `devel` branch within the Rubrik CDM PowerShell SDK contains the cmdlets, functions, and code needed in order to successfully generate a Rubrik As Built Report. This is why it is vital that `devel` is the active Rubrik module on the system generating the report. To install the `devel` branch follow the steps below:

1. Download the [devel](https://github.com/rubrikinc/rubrik-sdk-for-powershell/tree/devel) branch to your workstation.
1. Open a Powershell console with the _Run as Administrator_ option.
1. Run `Set-ExecutionPolicy` using the parameter _RemoteSigned_ or _Bypass_.
1. Run the `Install-Rubrik.ps1` script in the root of this repository and follow the prompts to install, upgrade, or delete your Rubrik Module contents.

### Installing the AsBuiltReport Module

Installing the As Built Report core module with the below instructions takes care of installing all of subsidary reports, including the Rubrik CDM core report.

Open a Windows PowerShell terminal window and install each of the required modules as follows;
```powershell
Install-Module AsBuiltReport
```

To install individual report modules the following can be utilized:
```powershell
Find-Module -Name AsBuiltReport.* -Repository PSGallery
Install-Module -Name AsBuiltReport.Vendor.Product
e.g. Install-Module -Name AsBuiltReport.Rubrik.CDM
```

### Required Priveleges

In order to generate a Rubrik CDM As Built Report, user credentials with the administrator role are required. The use of non-administrative credentials may produce undesired results.

### Configuration

The Rubrik CDM As Built Report utilises a JSON file to allow configuration of report information, options, detail and healthchecks. 

A Rubrik report configuration file can be generated by executing the following command;
```powershell
New-AsBuiltReportConfig -Report Rubrik.CDM -Path <User specified folder> -Name <Optional> 
```

Executing this command will copy the default Rubrik report JSON configuration to a user specified folder. 

All report settings can then be configured by directly modifying the JSON file.

The following provides information of how to configure each schema within the report's JSON file.

### Report
The **Report** sub-schema provides configuration of the vSphere report information

| Schema | Sub-Schema | Description |
| ------ | ---------- | ----------- |
| Report | Name | The name of the As Built Report
| Report | Version | The report version
| Report | Status | The report release status

### Options
The **Options** sub-schema allows certain options within the report to be toggled on or off

Currently the Rubrik CDM As Built Report does not utlize this section.

### InfoLevel
The **InfoLevel** sub-schema allows configuration of each section of the report at a granular level. The following sections can be set

| Schema | Sub-Schema | Default Setting |
| ------ | ---------- | --------------- |
| InfoLevel | Cluster | 3
| InfoLevel | SLADomains | 3
| InfoLevel | ProtectedObjects | 3
| InfoLevel | SnapshotRetention | 3

There are 4 levels (0/1/3/5) of detail granularity for each section as follows;

| Setting | InfoLevel | Description |
| ------- | ---- | ----------- |
| 0 | Disabled | does not collect or display any information
| 1 | Summary** | provides summarized information for a collection of objects
| 2 | Informative | reserved for future use
| 3 | Detailed | provides detailed information for individual objects
| 4 | Advanced Detailed | reserved for future use
| 5 | Comprehensive | provides comprehensive information for individual objects, such as advanced configuration settings

***Note*** While you can specify InfoLevels of 2 and 4, they will simply default to the closest defined level below them. IE 2 becomes 1 and 4 becomes 3. 

### Healthchecks

The `Healthcheck` section of the Rubrik CDM As Built Report is not currently utilized.

## Examples 
- Generate HTML & Word reports with Timestamp
Generate a Rubrik CDM As Built Report for a cluster named 'cluster1.domain.local' using specified credentials. Export report to HTML & DOC formats. Use default report style. Append timestamp to report filename. Save reports to 'C:\Reports\'
```powershell
New-AsBuiltReport -Target 'cluster1.domain.local' -Username 'administrator@domain.local' -Password 'SuperSecret' -Report Rubrik.CDM -Format Html,Word -OutputPath 'C:\Reports' -Timestamp
```
- Generate HTML & Text reports
Generate a Rubrik CDM As Built Report for a cluster named 'cluster1.domain.local' using stored credentials.  Export report to HTML & Text formats. Use default report style. Save reports to 'C:\Reports'
```powershell
New-AsBuiltReport -Target 'cluster1.domain.local' -Credential $Creds -Report Rubrik.CDM -Format Html,Text -OutputPath 'C:\Reports'
```
- Generate report with multiple Rubrik cluster using Custom Style
Generate a single Rubrik CDM As Built Report for clusters 'cluster1.domain.local' and 'cluster2.domain.org' using specified credentials. Report exports to WORD format by default. Apply custom style to the report. Reports are saved to the user profile folder by default.
```powershell
New-AsBuiltReport -Target 'cluster1.domain.local','cluster2.domain.org' -Username 'administrator@domain.local' -Password 'SuperSecret' -Report Rubrik.CDM -StylePath C:\Scripts\Styles\MyCustomStyle.ps1
```
***Note*** the Username/Password combiniation or credentials being passed/used must have administrative rights on both the `cluster1.domain.local` and `cluster2.domain.local` domains.

- Generate HTML & Word reports, attach and send reports via e-mail
Generate a Rubrik CDM As Built Report for the cluster named 'cluster1.domain.local' using specified credentials. Export report to HTML & DOC formats. Use default report style. Reports are saved to the user profile folder by default. Attach and send reports via e-mail.
```powershell
New-AsBuiltReport -Target 'cluster1.domain.local' -Username 'administrator@domain.local' -Password 'domain.local' -Report Rubrik.CDM -Format Html,Word -OutputPath C:\Reports -SendEmail
```

- Generate Word reports using the generated JSON config
```powershell
New-AsBuiltReport -Report Rubrik.CDM -Target <targetcluster> -Credential (Import-CliXML -Path <path_to_encrypted_creds>) -Format Word -Orientation Portrait -OutputPath <path_to_generated_report> -ReportConfigPath <path_to_AsBuiltReport.Rubrik.CDM.json> -AsBuiltConfigPath <path_to_as_built_config>
```

## Known Issues
- InfoLevel 3 and above causes "User Not Found" messages to be displayed on the console. 
  - While not a show stopper, when running the Rubrik CDM As Built Report with Cluster Info Level of 3 or higher User not found messages are shown on the console. This is the result of Rubrik tyring to query deeper information about users who no longer have an LDAP Account within the system. Reports continue to generate regardless of the error shown.
